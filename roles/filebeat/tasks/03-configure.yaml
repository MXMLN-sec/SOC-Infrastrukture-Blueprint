---
- name: Delete existing config file
  ansible.builtin.file:
    path: "{{ filebeat_config_file }}"
    state: absent
  tags:
    - configure


- name: Create new, empty config file
  ansible.builtin.file:
    path: "{{ filebeat_config_file }}"
    state: touch
  tags:
    - configure


- name: Add 'Do Not Edit' Disclaimer
  ansible.builtin.lineinfile: 
    dest: "{{ filebeat_config_file }}"
    line: "{{ donotedit_disclaimer }}"
  tags:
    - configure


- name: Add inputs config line
  ansible.builtin.lineinfile: 
    dest: "{{ filebeat_config_file }}"
    line: "filebeat.inputs:"
  tags:
    - configure


- name: Create input Filebeat config from multiple template files
  ansible.builtin.blockinfile:
    dest: "{{ filebeat_config_file }}"
    marker: "## Rendering {{ item }}"
    block: |
      {{ lookup('template', '{{ role_path }}/templates/{{ item }}') }}
  loop: "{{ input_templates }}"
  tags:
    - configure


- name: Create output Filebeat config from multiple template files
  ansible.builtin.blockinfile:
    dest: "{{ filebeat_config_file }}"
    marker: "## Rendering {{ item }}"
    block: |
      {{ lookup('template', '{{ role_path }}/templates/{{ item }}') }}
  loop: "{{ output_templates }}"
  tags:
    - configure